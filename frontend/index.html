<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>SubMagicGo — Video Player</title>
    
    <!-- Шрифты и иконки -->
    <link rel="preconnect" href="https://fonts.gstatic.com"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>

    <style>
        /* RESET */
        *,*::before,*::after { box-sizing:border-box; margin:0; padding:0; }
        html, body { height:100%; min-width:720px; min-height:720px; }
        button { font:inherit; }

        /* DESIGN TOKENS */
        :root {
            --bg: #f7f7f7;
            --surface: #ffffff;
            --surface-alt: #ececec;
            --primary: #4fa3ff;
            --primary-hover: #3578c6;
            --danger: #e74c3c;
            --danger-hover: #c0392b;
            --text: #222222;
            --text-muted: #6b7280;
            --border: #dadada;
            --radius: 12px;
            --shadow-sm: 0 2px 12px #0001;
            --shadow-md: 0 4px 18px #0002;
            --transition: .24s cubic-bezier(.4,0,.2,1);
        }
        @media (prefers-color-scheme: dark) {
            :root {
                --bg: #1f2937;
                --surface: #374151;
                --surface-alt: #4b5563;
                --primary: #60a5fa;
                --primary-hover: #3b82f6;
                --danger: #f87171;
                --danger-hover: #ef4444;
                --text: #f3f4f6;
                --text-muted: #9ca3af;
                --border: #4b5563;
                --shadow-sm: 0 2px 12px #0005;
                --shadow-md: 0 4px 18px #0006;
            }
        }

        /* LAYOUT */
        body {
            font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            display: flex;
            flex-direction: column;
        }
        header {
            width: 100%;
            display: flex;
            justify-content: center;
            margin-bottom: 1.5rem;
        }
        main {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 900px;
            margin-inline: auto;
            padding: clamp(1rem, 2vw, 2rem);
        }

        /* Components */
        .menu-btn {
            background: var(--surface-alt);
            border: none;
            border-radius: var(--radius) var(--radius) 0 0;
            padding: .5rem 1.25rem;
            font-size: 1.05rem;
            color: var(--text-muted);
            font-weight: 500;
            cursor: pointer;
            transition: background var(--transition), color var(--transition);
        }
        .menu-btn.active {
            background: var(--surface);
            color: var(--text);
            font-weight: 600;
        }

        .dropzone {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            width: 100%;
            min-height: 220px;
            padding: 4rem 1rem;
            text-align: center;
            background: var(--surface);
            border: 2.5px dashed var(--border);
            border-radius: var(--radius);
            color: var(--text-muted);
            transition: all var(--transition);
            cursor: pointer;
            user-select: none;
        }
        .dropzone.dragover {
            border-color: var(--primary);
            color: var(--primary);
            background: color-mix(in srgb, var(--primary) 10%, transparent);
            box-shadow: var(--shadow-md);
        }

        video {
            width: 100%;
            height: auto;
            border-radius: var(--radius);
            background: #000;
        }

        .controls {
            display: grid;
            grid-auto-flow: column;
            gap: clamp(.5rem, 1.5vw, 1.25rem);
            justify-content: center;
            margin-top: 2rem;
            width: 100%;
        }
        @media (max-width: 700px) {
            .controls {
                grid-auto-flow: row;
                grid-template-columns: repeat(auto-fit, minmax(8rem, 1fr));
            }
        }
        .btn {
            appearance: none;
            background: var(--primary);
            color: #fff;
            border: none;
            border-radius: var(--radius);
            padding: .9rem 1.5rem;
            font-size: 1rem;
            font-weight: 600;
            letter-spacing: .3px;
            box-shadow: var(--shadow-sm);
            cursor: pointer;
            transition: background var(--transition), transform var(--transition), box-shadow var(--transition);
        }
        .btn:hover, .btn:focus-visible {
            background: var(--primary-hover);
            transform: translateY(-2px) scale(1.03);
            box-shadow: var(--shadow-md);
        }
        .btn--danger {
            background: var(--danger);
        }
        .btn--danger:hover, .btn--danger:focus-visible {
            background: var(--danger-hover);
        }

        .sr-only {
            position: absolute !important;
            width: 1px; height: 1px;
            padding: 0; margin: -1px;
            overflow: hidden;
            clip: rect(0,0,0,0);
            white-space: nowrap;
            border: 0;
        }

        /* --- Whisper Settings Modern UI --- */
        .whisper-section {
            width: 100%;
            max-width: 520px;
            margin: 0 auto 2.2rem auto;
            background: var(--surface);
            border-radius: 18px;
            box-shadow: var(--shadow-md);
            padding: 2rem 1.5rem 1.5rem 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: stretch;
        }
        .whisper-section-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 1.2rem;
            letter-spacing: -0.5px;
        }
        .whisper-download-row {
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 0.5rem;
        }
        .whisper-download-row label {
            font-size: 1.08rem;
            font-weight: 500;
        }
        .whisper-download-row select {
            background: var(--surface-alt);
            color: var(--text);
<<<<<<< HEAD
            border: 2px solid transparent;
            border-radius: 12px;
            padding: 12px 16px;
            font-size: 1rem;
            font-weight: 500;
            outline: none;
            min-width: 200px;
            cursor: pointer;
            transition: all var(--transition);
            box-shadow: var(--shadow-sm);
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg fill='%234fa3ff' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 20px;
            padding-right: 40px;
        }
        .whisper-download-row select:hover {
            border-color: var(--primary);
            background-color: color-mix(in srgb, var(--primary) 5%, var(--surface-alt));
            box-shadow: var(--shadow-md);
        }
        .whisper-download-row select:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px color-mix(in srgb, var(--primary) 20%, transparent);
        }
        .whisper-download-row select:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .whisper-download-row select option {
            background: var(--surface);
            color: var(--text);
            padding: 8px 12px;
            border-radius: 8px;
            margin: 2px 0;
        }
        .whisper-download-row select option:hover, 
        .whisper-download-row select option:focus {
            background: var(--primary);
            color: #fff;
=======
            border: none;
            border-radius: 7px;
            padding: 7px 16px;
            font-size: 1.08rem;
            outline: none;
>>>>>>> 1c16b9c57654212a0011165ba3c6458c1639bb75
        }
        .whisper-download-btn {
            background: var(--primary);
            color: #fff;
            font-size: 1.08rem;
            font-weight: 700;
            border-radius: 12px;
            padding: 0.6em 1.7em;
            border: none;
            cursor: pointer;
            transition: background 0.18s;
        }
        .whisper-download-btn:disabled {
            background: #b3d4fc;
            color: #fff;
            cursor: default;
        }
        .whisper-download-btn:not(:disabled):hover {
            background: var(--primary-hover);
        }
        .whisper-progress {
            background: #4fa3ff33;
            color: var(--primary);
            font-size: 1em;
            border-radius: 8px;
            width: 0;
            height: 22px;
            line-height: 22px;
            transition: width 0.2s;
            display: none;
            text-align: center;
            margin-left: 10px;
            min-width: 60px;
        }
        .whisper-divider {
            border: none;
            border-top: 2px solid var(--surface-alt);
            margin: 2.5rem 0 2rem 0;
        }
        .whisper-models-list {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 1.1rem;
        }
        .whisper-model-card {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--surface-alt);
            border-radius: 14px;
            box-shadow: 0 2px 12px #0001;
            padding: 0.9rem 1.2rem;
            transition: box-shadow 0.18s, background 0.18s;
            position: relative;
        }
        .whisper-model-card:hover {
            box-shadow: 0 6px 24px #0002;
            background: color-mix(in srgb, var(--primary) 7%, var(--surface-alt));
        }
        .whisper-model-info {
            display: flex;
            align-items: center;
            gap: 14px;
        }
        .whisper-model-icon {
            width: 26px;
            height: 26px;
            color: var(--primary);
            flex-shrink: 0;
        }
        .whisper-model-name {
            font-size: 0.98rem;
            font-weight: 600;
            color: var(--text);
            min-width: 60px;
        }
        .whisper-model-status {
            font-size: 0.93rem;
            font-weight: 400;
            color: var(--text-muted);
            margin-left: 4px;
        }
        .whisper-model-status.downloaded {
            color: var(--primary);
        }
        .whisper-radio {
            width: 20px;
            height: 20px;
            accent-color: var(--primary);
        }
        .whisper-model-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .whisper-btn-delete {
            background: #e0e7ef;
            color: #c0392b;
            font-size: 0.98rem;
            font-weight: 600;
            border-radius: 8px;
            padding: 0.4em 1.1em;
            border: none;
            cursor: pointer;
            transition: background 0.18s, color 0.18s;
        }
        .whisper-btn-delete:hover {
            background: #fbeaea;
            color: #a8231a;
        }
        .whisper-empty {
            color: var(--text-muted);
            font-size: 1.08rem;
            text-align: center;
            margin-top: 1.5rem;
        }
        @media (max-width: 700px) {
            .whisper-section { padding: 1.1rem 0.2rem; }
            .whisper-model-card { flex-direction: column; align-items: flex-start; gap: 8px; padding: 0.8rem 0.5rem; }
        }
    </style>
</head>
<body>
<header>
    <nav>
        <button class="menu-btn active" type="button">Редактор</button>
        <button class="menu-btn" type="button">Настройки</button>
    </nav>
</header>
<main>
    <div class="container">
        <section id="editorPanel">
            <div id="dropzone" class="dropzone" tabindex="0" role="button" aria-label="Перетащите файл или нажмите для выбора">
                <span>Перетащите видеофайл сюда<br>или нажмите, чтобы выбрать</span>
            </div>
            <input id="fileInput" type="file" accept="video/*" class="sr-only"/>
            <video id="video" controls style="display:none;" tabindex="0"></video>
            <p id="videoTitle" style="display:none; margin-top:1rem; font-weight:500; text-align:center;"></p>
            <div id="controls" class="controls" style="display:none;">
                <button id="openBtn" class="btn" type="button">Открыть</button>
                <button id="playPauseBtn" class="btn" type="button">▶</button>
                <button id="subBtn" class="btn" type="button">Создать субтитры</button>
                <button id="exportBtn" class="btn" type="button" style="display:none;">Экспорт SRT</button>
                <button id="closeMediaBtn" class="btn btn--danger" type="button">Закрыть медиа</button>
            </div>
        </section>
        <section id="settingsPanel" style="display:none; background:none; box-shadow:none; padding:0; max-width:none;">
            <div class="whisper-section">
                <div class="whisper-section-title">Доступные модели для скачивания</div>
                <div class="whisper-download-row">
                    <label for="modelSelect">Модель:</label>
                    <select id="modelSelect"></select>
                    <button id="downloadBtn" class="whisper-download-btn">Скачать</button>
                    <div id="downloadProgress" class="whisper-progress"></div>
                </div>
            </div>
            <hr class="whisper-divider" />
            <div class="whisper-section">
                <div class="whisper-section-title">Скачанные модели</div>
                <div id="modelsList" class="whisper-models-list"></div>
                <div id="emptyList" class="whisper-empty" style="display:none;"></div>
            </div>
        </section>
    </div>
</main>
<<<<<<< HEAD
<!-- Кастомный модал для подтверждения удаления -->
<div id="deleteConfirmModal" style="display:none; position:fixed; left:0; top:0; width:100vw; height:100vh; background:#0005; z-index:9999; align-items:center; justify-content:center;">
  <div style="background:#fff; color:#222; border-radius:12px; box-shadow:0 4px 24px #0003; padding:2rem 2.5rem; min-width:320px; max-width:90vw; text-align:center;">
    <div id="deleteConfirmText" style="font-size:1.1rem; margin-bottom:1.5rem;"></div>
    <button id="deleteConfirmYes" style="background:#e74c3c; color:#fff; border:none; border-radius:8px; padding:0.5em 1.5em; font-size:1rem; margin-right:1.2em; cursor:pointer;">Удалить</button>
    <button id="deleteConfirmNo" style="background:#e0e7ef; color:#222; border:none; border-radius:8px; padding:0.5em 1.5em; font-size:1rem; cursor:pointer;">Отмена</button>
  </div>
</div>
=======
>>>>>>> 1c16b9c57654212a0011165ba3c6458c1639bb75
<script>
    const $ = id => document.getElementById(id);
    const video = $("video"), openBtn = $("openBtn"), playPauseBtn = $("playPauseBtn"),
          fileInput = $("fileInput"), dropzone = $("dropzone"), subBtn = $("subBtn"),
          exportBtn = $("exportBtn"), controls = $("controls"), closeBtn = $("closeMediaBtn"),
          videoTitle = $("videoTitle");
    let selectedModel = localStorage.getItem("whisperModel") || "base", downloadProgress = {}, currentFilePath = null;
    const show = el => el.style.display = "", hide = el => el.style.display = "none";
    playPauseBtn.addEventListener("click", () => video.paused ? video.play() : video.pause());
    video.addEventListener("play", () => playPauseBtn.textContent = "⏸");
    video.addEventListener("pause", () => playPauseBtn.textContent = "▶");
    openBtn.addEventListener("click", () => fileInput.click());
    fileInput.addEventListener("change", e => e.target.files[0] && loadVideo(e.target.files[0]));
    function loadVideo(file) {
        currentFilePath = file.path || null;
        video.src = URL.createObjectURL(file);
        video.play();
        videoTitle.textContent = file.name;
        show(video); show(videoTitle); show(controls); hide(dropzone);
    }
    ["dragenter","dragover"].forEach(ev => dropzone.addEventListener(ev, e => { e.preventDefault(); dropzone.classList.add("dragover"); }));
    ["dragleave","drop"].forEach(ev => dropzone.addEventListener(ev, e => { e.preventDefault(); dropzone.classList.remove("dragover"); }));
    dropzone.addEventListener("drop", e => e.dataTransfer.files[0] && loadVideo(e.dataTransfer.files[0]));
    dropzone.addEventListener("click", () => fileInput.click());
    subBtn.addEventListener("click", async () => {
        if (!currentFilePath) { alert("Сначала выберите видео!"); return; }
        subBtn.disabled = true; subBtn.textContent = "Генерация...";
        try { await window.go.main.App.GenerateSubtitles(currentFilePath, "ru", selectedModel); show(exportBtn); }
        catch (err) { alert("Ошибка генерации субтитров: " + err); }
        subBtn.disabled = false; subBtn.textContent = "Создать субтитры";
    });
    exportBtn.addEventListener("click", () => {
        if (!currentFilePath) return;
        const blob = new Blob([currentFilePath], { type: "text/plain" });
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = "subtitles.srt";
        a.click();
    });
    closeBtn.addEventListener("click", () => {
        video.pause(); video.removeAttribute("src"); video.load();
        hide(video); hide(videoTitle); hide(exportBtn); hide(controls);
        dropzone.querySelector("span").innerHTML = "Перетащите видеофайл сюда<br>или нажмите, чтобы выбрать";
        show(dropzone);
        currentFilePath = null; fileInput.value = "";
    });
    window.runtime?.EventsOn?.("modelDownloadProgress", data => {
        downloadProgress[data.name] = data.percent;
        const bar = document.getElementById(`progress_${data.name}`), btn = document.getElementById(`dl_${data.name}`);
        if (bar) { bar.style.width = data.percent + "%"; bar.textContent = data.percent + "%"; }
        if (data.percent >= 100 && btn) { btn.textContent = "✓"; btn.disabled = true; bar.style.display = "none"; }
    });

    // --- Переключение вкладок ---
    const editorTab = document.querySelector('.menu-btn.active');
    const settingsTab = document.querySelectorAll('.menu-btn')[1];
    const editorPanel = document.getElementById('editorPanel');
    const settingsPanel = document.getElementById('settingsPanel');
    function showEditor() {
        editorPanel.style.display = '';
        settingsPanel.style.display = 'none';
        editorTab.classList.add('active');
        settingsTab.classList.remove('active');
    }
    function showSettings() {
        editorPanel.style.display = 'none';
        settingsPanel.style.display = '';
        editorTab.classList.remove('active');
        settingsTab.classList.add('active');
        loadModels();
    }
    editorTab.addEventListener('click', showEditor);
    settingsTab.addEventListener('click', showSettings);

    // --- JS: Whisper Settings ---
    let availableModels = [];
    let downloadedModels = [];
    let activeModel = localStorage.getItem('whisperModel') || null;
    let downloading = false;
    let downloadingModel = null;

    async function loadModels() {
        const modelSelect = document.getElementById('modelSelect');
        const downloadBtn = document.getElementById('downloadBtn');
        const downloadProgressDiv = document.getElementById('downloadProgress');
        const modelsListDiv = document.getElementById('modelsList');
        const emptyListDiv = document.getElementById('emptyList');
        modelSelect.innerHTML = '';
        modelsListDiv.innerHTML = '';
        emptyListDiv.style.display = 'none';
<<<<<<< HEAD
        
        // Загружаем активную модель с сервера
        try {
            const serverActiveModel = await window.go.main.App.GetActiveModel();
            if (serverActiveModel) {
                activeModel = serverActiveModel;
                localStorage.setItem('whisperModel', activeModel);
            }
        } catch (e) {
            console.log('Ошибка загрузки активной модели:', e);
        }
        
=======
>>>>>>> 1c16b9c57654212a0011165ba3c6458c1639bb75
        try {
            const all = await window.go.main.App.ListModels();
            // Сортируем по expectedSize (байты)
            availableModels = all.filter(m => !m.local).sort((a, b) => (a.expectedSize||a.size||0) - (b.expectedSize||b.size||0));
            downloadedModels = all.filter(m => m.local).sort((a, b) => (a.expectedSize||a.size||0) - (b.expectedSize||b.size||0));
            // --- Render download block ---
            if (availableModels.length === 0) {
                modelSelect.disabled = true;
                downloadBtn.disabled = true;
                downloadBtn.textContent = 'Нет новых моделей';
            } else {
                modelSelect.disabled = false;
                downloadBtn.disabled = false;
                availableModels.forEach((m, i) => {
                    const opt = document.createElement('option');
                    opt.value = m.name;
                    opt.textContent = `${m.name} (${formatModelSize(m.expectedSize||m.size)})`;
                    modelSelect.appendChild(opt);
                });
                modelSelect.value = availableModels[0].name;
                downloadBtn.textContent = 'Скачать';
            }
            // --- Download button logic ---
            let selectedModel = modelSelect.value;
            modelSelect.onchange = e => { selectedModel = e.target.value; };
            downloadBtn.onclick = async () => {
                if (!selectedModel || downloading) return;
                downloading = true;
                downloadBtn.disabled = true;
                downloadBtn.textContent = 'Загрузка...';
                downloadProgressDiv.style.display = 'block';
                downloadProgressDiv.textContent = '0%';
                try {
                    await window.go.main.App.DownloadModel(selectedModel);
                } catch (e) {
                    downloadProgressDiv.textContent = 'Ошибка загрузки';
                } finally {
                    downloading = false;
                    loadModels();
                    downloadProgressDiv.style.display = 'none';
                }
            };
            // --- Render downloaded models ---
            if (downloadedModels.length === 0) {
                emptyListDiv.style.display = 'block';
                emptyListDiv.textContent = 'Нет загруженных моделей Whisper';
                return;
            }
            emptyListDiv.style.display = 'none';
            downloadedModels.forEach(model => {
                const card = document.createElement('div');
                card.className = 'whisper-model-card';
                // Левая часть: иконка + radio + имя + статус
                const info = document.createElement('div');
                info.className = 'whisper-model-info';
                const icon = document.createElement('span');
                icon.className = 'whisper-model-icon';
                icon.innerHTML = `<svg fill='none' stroke='currentColor' stroke-width='2' viewBox='0 0 24 24'><rect x='3' y='7' width='18' height='13' rx='3'/><path d='M16 3v4M8 3v4'/></svg>`;
                const radio = document.createElement('input');
                radio.type = 'radio';
                radio.name = 'activeModel';
                radio.value = model.name;
                radio.checked = activeModel === model.name;
                radio.className = 'whisper-radio';
<<<<<<< HEAD
                radio.onchange = async () => {
                    activeModel = model.name;
                    localStorage.setItem('whisperModel', activeModel);
                    // Уведомляем бэкенд о смене активной модели
                    try {
                        await window.go.main.App.SetActiveModel(activeModel);
                    } catch (e) {
                        console.error('Ошибка установки активной модели:', e);
                    }
                    selectedModel = activeModel; // Обновляем глобальную переменную
=======
                radio.onchange = () => {
                    activeModel = model.name;
                    localStorage.setItem('whisperModel', activeModel);
>>>>>>> 1c16b9c57654212a0011165ba3c6458c1639bb75
                    loadModels();
                };
                const name = document.createElement('span');
                name.textContent = model.filename || model.name;
                name.className = 'whisper-model-name';
                const status = document.createElement('span');
                status.className = 'whisper-model-status downloaded';
                status.innerHTML = formatModelSize(model.expectedSize||model.size);
                info.appendChild(icon);
                info.appendChild(radio);
                info.appendChild(name);
                info.appendChild(status);
                // Правая часть: удалить
                const actions = document.createElement('div');
                actions.className = 'whisper-model-actions';
                const btnDelete = document.createElement('button');
                btnDelete.className = 'whisper-btn-delete';
                btnDelete.textContent = 'Удалить';
                btnDelete.onclick = async (e) => {
                    e.stopPropagation();
<<<<<<< HEAD
                    console.log('=== НАЧАЛО УДАЛЕНИЯ МОДЕЛИ ===');
                    console.log('Событие клика по кнопке удаления зарегистрировано');
                    console.log('Модель для удаления:', {
                        name: model.name,
                        filename: model.filename,
                        size: model.size,
                        expectedSize: model.expectedSize
                    });
                    
                    const confirmed = await customConfirm(`Удалить модель ${model.filename || model.name}?`);
                    if (confirmed) {
                        console.log('Пользователь подтвердил удаление модели:', model.name);
                        try {
                            console.log('Отключение кнопки и изменение текста...');
                            btnDelete.disabled = true;
                            btnDelete.textContent = 'Удаление...';
                            
                            console.log('Вызов window.go.main.App.DeleteModel с параметром:', model.name);
                            console.log('Проверка доступности API:', typeof window.go?.main?.App?.DeleteModel);
                            
                            if (!window.go?.main?.App?.DeleteModel) {
                                throw new Error('API функция DeleteModel недоступна');
                            }
                            
                            const result = await window.go.main.App.DeleteModel(model.name);
                            console.log('Результат вызова DeleteModel:', result);
                            console.log('Модель успешно удалена:', model.name);
                            
                            console.log('Обновление списка моделей...');
                            loadModels();
                            console.log('=== УДАЛЕНИЕ ЗАВЕРШЕНО УСПЕШНО ===');
                        } catch (error) {
                            console.error('=== ОШИБКА ПРИ УДАЛЕНИИ МОДЕЛИ ===');
                            console.error('Детали ошибки:', error);
                            console.error('Тип ошибки:', typeof error);
                            console.error('Сообщение ошибки:', error.message || error.toString());
                            console.error('Stack trace:', error.stack);
                            
                            alert('Ошибка при удалении модели: ' + (error.message || error.toString()));
                            
                            console.log('Восстановление состояния кнопки...');
                            btnDelete.disabled = false;
                            btnDelete.textContent = 'Удалить';
                            console.error('=== КОНЕЦ ОБРАБОТКИ ОШИБКИ ===');
                        }
                    } else {
                        console.log('Пользователь отменил удаление модели:', model.name);
                        console.log('=== УДАЛЕНИЕ ОТМЕНЕНО ===');
=======
                    if (confirm(`Удалить модель ${model.filename || model.name}?`)) {
                        await window.go.main.App.DeleteModel(model.name);
                        loadModels();
>>>>>>> 1c16b9c57654212a0011165ba3c6458c1639bb75
                    }
                };
                actions.appendChild(btnDelete);
                card.appendChild(info);
                card.appendChild(actions);
                modelsListDiv.appendChild(card);
            });
        } catch (e) {
            emptyListDiv.style.display = 'block';
            emptyListDiv.textContent = 'Ошибка загрузки моделей Whisper';
        }
    }
    // Форматирование размера модели (MB/GB)
    function formatModelSize(bytes) {
        if (!bytes) return '';
        if (bytes >= 1024*1024*1024) return (bytes/1024/1024/1024).toFixed(1) + ' GB';
        return (bytes/1024/1024).toFixed(0) + ' MB';
    }
    // --- Прогресс загрузки ---
    window.runtime && window.runtime.EventsOn && window.runtime.EventsOn("modelDownloadProgress", data => {
        const downloadProgressDiv = document.getElementById('downloadProgress');
<<<<<<< HEAD
        const downloadBtn = document.getElementById('downloadBtn');
        if (!downloadProgressDiv) return;
        
        // Обновляем прогресс бар
        downloadProgressDiv.style.display = 'block';
        downloadProgressDiv.textContent = data.percent + '%';
        downloadProgressDiv.style.width = data.percent + '%';
        
        // Когда загрузка завершена
        if (data.percent >= 100) {
            setTimeout(() => {
                downloadProgressDiv.style.display = 'none';
                downloadBtn.textContent = 'Скачать';
                downloadBtn.disabled = false;
                downloading = false;
                loadModels(); // Обновляем список моделей
            }, 500);
        }
    });
    // --- Кастомный confirm ---
    function customConfirm(message) {
        return new Promise(resolve => {
            const modal = document.getElementById('deleteConfirmModal');
            const text = document.getElementById('deleteConfirmText');
            const yes = document.getElementById('deleteConfirmYes');
            const no = document.getElementById('deleteConfirmNo');
            text.textContent = message;
            modal.style.display = 'flex';
            function cleanup(result) {
                modal.style.display = 'none';
                yes.removeEventListener('click', onYes);
                no.removeEventListener('click', onNo);
                resolve(result);
            }
            function onYes() { cleanup(true); }
            function onNo() { cleanup(false); }
            yes.addEventListener('click', onYes);
            no.addEventListener('click', onNo);
        });
    }
=======
        if (!downloadProgressDiv) return;
        if (data.name === document.getElementById('modelSelect').value) {
            downloadProgressDiv.style.display = 'block';
            downloadProgressDiv.textContent = data.percent + '%';
            if (data.percent >= 100) {
                downloadProgressDiv.style.display = 'none';
            }
        }
    });
>>>>>>> 1c16b9c57654212a0011165ba3c6458c1639bb75
</script>
</body>
</html>